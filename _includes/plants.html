<!-- Include for Plants Table -->

{% if include.show_select %}
<input class="createList" id="create_list_button" type="submit" value="Create List" />
<div style="clear:both"></div>
{% endif %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
<div class="plant_filters">
    <div id="new_search_location"></div>
    <div class="filter_input">
        <div class="input_label">
            Sun:
        </div>
        <select class="sun_requirement">
            <option value="any" selected="selected">Any</option>
            <option value="full_sun">Full Sun</option>
            <option value="part_shade">Part Shade</option>
            <option value="full_shade">Full Shade</option>
        </select>
    </div>
    <div class="filter_input">
        <div class="input_label">
            Height:
        </div>
        <select class="height_requirement">
            <option value="any" selected="selected">Any</option>
            <option value="very_low">Very Low</option>
            <option value="low">Low</option>
            <option value="medium">Moderate</option>
            <option value="tall">Tall</option>
            <option value="very_tall">Very Tall</option>
        </select>
    </div>
    <div class="filter_input">
        <div class="input_label">
            Category:
        </div>
        <select class="category_requirement">
            <option value="any" selected="selected">Any</option>
            <option value="perennial_herbs">Perennial Herbs</option>
            <option value="shrubs">Shrubs</option>
            <option value="trees">Trees</option>
            <option value="annual_herbs">Annual Herbs</option>
            <option value="grasses">Grasses</option>
            <option value="vines">Vines</option>
            <option value="ferns">Ferns</option>
        </select>
    </div>
</div>

<form id="myForm" method="get" action="{{'/custom_plant_list' | prepend:site.baseurl }}">
    <input type="hidden" id="encoded_plants" name="encoded_plants" value="" />
</form>

<table class="plant_table">
	<thead>
		<tr>
            {% if include.show_select %}
            <th>
            </th>
            {% endif %}
			<th class="name">Name</th>
			<th class="sun">Sun</th>
			<th class="height">Height</th>
			<th class="category">Category</th>
            <th class="more_info">More Info</th>
		</tr>
	</thead>
	<tbody>
{% for item in include.plants %}
      	<tr>	
        {% if include.show_select %}
            <td>   
                <!-- TODO retain state if checkbox is selected? --> 
                <input type="checkbox" name="test" value="{{item.id}}" />
            </td>
        {% endif %}
		<td class="name">
            {% if item.icon %}
                <img src="{{ item.icon | prepend: site.baseurl }}" alt="{{item.common_name}}"/>
            {% endif %}
            <div class="name">
                <a href="{{ item.permalink | prepend:site.baseurl }}">
                    {{item.common_name}}
                </a>
                <div class="scientific_name">{{item.scientific_name}}</div>
            </div>
		</td>
 		{% comment %}
		Use for sorting:
			Full Sun = a
			Part Shade = b
 			Full Shade = c
 		{% endcomment %}
		
		{% assign sort_param = "" %}
		{% assign full_sun_class = '' %}
		{% assign part_shade_class = '' %}
		{% assign full_shade_class = '' %}

		{% if item.sun_requirements contains 'Full Sun' %}
		   {% assign full_sun_class = 'visible' %}
		   {% assign sort_param = sort_param | append: "a" %}
		{% endif %}
		{% if item.sun_requirements contains 'Part Shade' %}
		   {% assign part_shade_class = 'visible' %}
		   {% assign sort_param = sort_param | append: "b" %}
		{% endif %}
		{% if item.sun_requirements contains 'Full Shade' %}
		   {% assign full_shade_class = 'visible' %}
		   {% assign sort_param = sort_param | append: "c" %}
		{% endif %}

		<td class="sun sun_req" data-order="{{sort_param}}">
			<div class="full_sun {{full_sun_class}}"></div>
			<div class="part_shade {{part_shade_class}}"></div>
			<div class="full_shade {{full_shade_class}}"></div>
		</td>
		
		{% assign height_category = "" %}
		{% assign height_text = "" %}

		{% if item.plant_size %}
			{% for plant_size_obj in item.plant_size %}
			   
 			   {% assign max_plant_height = plant_size_obj.height | last | plus: 0 %}
			   {%comment%} Decide what text to display to describe height. {%endcomment%}	
			   {% if max_plant_height <= 1.5 %}
			   	{% assign height_category = "Very Low" %}
			   	{% assign height_text = "< 1.5 ft " %}
			   {% elsif max_plant_height <= 3 %}
			   	{% assign height_category = "Low" %}
			   	{% assign height_text = "< 3 ft" %}
			   {% elsif max_plant_height <= 6 %}
			   	{% assign height_category = "Moderate" %}
			   	{% assign height_text = "< 6 ft" %}
			   {% elsif max_plant_height <= 10 %}
			   	{% assign height_category = "Tall" %}
			   	{% assign height_text = "< 10 ft" %}
			   {% else %}
			   	{% assign height_category = "Very Tall" %}
			   	{% assign height_text = " > 10 ft" %}
			   {% endif %} 		
			{% endfor %}
		{% endif %}

		<td class="height" data-order="{{max_plant_height}}" >
		     <div class="height_category">
			{{ height_category }} 
		     </div>
		     <div class="height">
			{{ height_text }}
		     </div>
		</td>
		{% assign top_level_category = item.categories | first %}
	    {% assign category_name = top_level_category | replace:" ","_" | replace:"-", "_" | replace:"&", "and" | downcase %}
		{% assign category_url = "/plants/" | prepend:site.baseurl | append: category_name %}
		<td class="category">
			{% comment %} TODO figure out how to handle category => url {% endcomment %}
			<a href="{{ category_url }}"> 
                <span class="{{category_name}}">
				    {{top_level_category | capitalize }}
                </span>
			</a>
		</td>
		<td class="more_info">
			{% if item.calscape_link %}
				<a href="{{item.calscape_link}}" target="_blank">View on Calscape</a>
			{% elsif item.calflora_link %}
				<a href="{{item.calflora_link}}" target="_blank">View on Calflora</a>
			{% endif %} 
		</td>
	</tr>
{% endfor %}
	</tbody>
</table>

